(function(f,k){"object"===typeof module&&module.exports?module.exports=k(require("jquery")):k(f.jQuery)})(this,function(f){var k=function(a,c){this.options=c;this.$element="";this.language=G[this.options.locale];this.uploadList=[];this.totalProgress=[];this.toUpload=[];this.imgNames=[];this.currentListLength=this.inProgress=this.pending=this.abortedWithError=this.aborted=this.successfulUpload=this.totalFilesLength=0;this.init(a)};k.prototype.init=function(a){f(a).addClass("ssi-uploadInput").after(this.$element=
f('<div class="ssi-uploader">'));a=f('<span class="ssi-InputLabel"><button class="ssi-button success">'+this.language.chooseFiles+"</button></span>").append(a);var c=f('<button id="ssi-uploadBtn" class="ssi-button success ssi-hidden" ><span class="ssi-btnIn">'+this.language.upload+'&nbsp;</span><div id="ssi-up_loading" class="ssi-btnIn"></div></button>'),d=f('<button id="ssi-clearBtn" class="ssi-hidden ssi-button info" >'+this.language.clear+"</button>"),b=f('<button id="ssi-abortBtn" class="ssi-button error ssi-cancelAll ssi-hidden" ><span class="inBtn">'+
this.language.abort+" </span></button>");this.$element.append(f('<div class="ssi-buttonWrapper">').append(a,b,c,d));var e;if(this.options.preview)e=f('<div id="ssi-previewBox" class="ssi-uploadBox ssi-previewBox '+(this.options.dropZone?'ssi-dropZonePreview ssi-dropZone"><div id="ssi-DropZoneBack">'+this.language.drag+"</div>":'">')+"</div>"),this.$element.append(e);else{this.$element.addClass("ssi-uploaderNP");var l=f('<table id="ssi-fileList" class="ssi-fileList"></table>'),r=f('<span class="ssi-namePreview"></span>'),
h=f('<div id="ssi-uploadFiles" class="ssi-tooltip ssi-uploadFiles '+(this.options.dropZone?"ssi-dropZone":"")+'"><div id="ssi-uploadProgressNoPreview" class="ssi-uploadProgressNoPreview"></div></div>').append(r),k=f('<div class="ssi-uploadDetails"></div>').append(l);e=f('<div class="ssi-uploadBoxWrapper ssi-uploadBox"></div>').append(h,k);this.$element.prepend(e)}var g=this,n=a.find(".ssi-uploadInput");a.find("button").click(function(){n.trigger("click")});n.on("change",function(){g.toUploadFiles(this.files);
n.val("")});g.options.dropZone&&(e.on("drop",function(a){a.preventDefault();e.removeClass("ssi-dragOver");g.toUploadFiles(a.originalEvent.dataTransfer.files)}),e.on("dragover",function(a){a.preventDefault();e.addClass("ssi-dragOver");return!1}),e.on("dragleave",function(a){a.preventDefault();e.removeClass("ssi-dragOver");return!1}));g.options.preview||h.click(function(){1<g.currentListLength&&k.toggleClass("ssi-uploadBoxOpened")});d.click(function(){g.clear()});var m;e.on("mouseenter",".ssi-statusLabel",
function(a){a=f(a.currentTarget);var b=a.attr("data-status");if(b&&""!==b){var d="35";a.hasClass("ssi-noPreviewSubMessage")&&(d=0);m=f('<div class="ssi-infoTooltip">'+b+"</div>").appendTo(g.$element).css({top:a.position().top-d,left:a.position().left-5}).fadeIn("slow")}});e.on("mouseleave",".ssi-statusLabel",function(){m&&m.remove()});e.on("click",".ssi-removeBtn",function(a){var b=f(a.currentTarget);a=b.data("delete");g.pending--;g.currentListLength--;0===g.pending&&c.prop("disabled",!0);g.options.preview?
b.parents("table.ssi-imgToUploadTable").remove():(b=b.parents("tr.ssi-toUploadTr"),r.html(g.currentListLength+" files"),b.prev().remove(),b.remove(),1===g.currentListLength&&B(g));g.toUpload[a]=null;g.imgNames[a]=null;0===g.currentListLength&&(g.options.dropZone||e.removeClass("ssi-uploadNoDropZone"),d.addClass("ssi-hidden"),c.addClass("ssi-hidden"))});e.on("click",".ssi-abortUpload",function(a){a=f(a.currentTarget).data("delete");u(g,a)});c.click(function(){g.uploadFiles()});b.click(function(){for(var a=
0;a<g.uploadList.length;a++)"object"===typeof g.uploadList[a]&&u(g,a)})};k.prototype.toUploadFiles=function(a){function c(){var a=d.totalFilesLength+d.pending;0===a&&(d.options.preview&&(d.options.dropZone||g.addClass("ssi-uploadNoDropZone")),r.removeClass("ssi-hidden"),h.removeClass("ssi-hidden"));h.prop("disabled",!1);d.toUpload[a]=p;var c=p.name,m=c.getExtension();d.imgNames[a]=c;if(d.options.preview){var e=function(b){return'<table class="ssi-imgToUploadTable ssi-pending"><tr><td class="ssi-upImgTd">'+
b+'</td></tr><tr><td><div id="ssi-uploadProgress'+a+'" class="ssi-hidden ssi-uploadProgress"></div></td></tr><tr><td><button data-delete="'+a+'" class=" ssi-button error ssi-removeBtn"><span class="trash10 trash"></span></button></td></tr><tr><td>'+v(c,m,15)+"</td></tr></table>"};if("image"==p.type.split("/")[0]){r.prop("disabled",!0);h.prop("disabled",!0);var f=new FileReader;f.onload=function(){l+=e('<img class="ssi-imgToUpload" src=""/><i class="fa-spin fa fa-spinner fa-pulse"></i>');n[a]=f.result;
b++;t===b&&(g.append(l),r.prop("disabled",!1),h.prop("disabled",!1),setTimeout(function(){for(var a=0;a<n.length;a++)null!==n[a]&&(g.find("#ssi-uploadProgress"+a).parents("table.ssi-imgToUploadTable").find(".ssi-imgToUpload").attr("src",n[a]).next().remove(),n[a]=null);n=[]},10),l="",t=[])};f.readAsDataURL(p)}else n[a]=null,g.append(e('<div class="document-item" href="test.mov" filetype="'+m+'"><span class = "fileCorner"></span></div>')),b++}else d.$element.find(".ssi-namePreview").html(0===a?v(c,
m,13):d.currentListLength+1+" "+d.language.files),k.append('<tr class="ssi-space"><td></td></tr><tr class="ssi-toUploadTr ssi-pending"><td><div id="ssi-uploadProgress'+a+'" class="ssi-hidden ssi-uploadProgress ssi-uploadProgressNoPre"></div><span>'+v(c,m,20)+'</span></td><td><a data-delete="'+a+'" class="ssi-button ssi-removeBtn  ssi-removeBtnNP"><span class="trash7 trash"></span></a></td></tr>')}if(!("number"===typeof this.options.maxNumberOfFiles&&this.inProgress+this.pending>=this.options.maxNumberOfFiles)){var d=
this,b=0,e,l="",r=this.$element.find("#ssi-uploadBtn"),h=this.$element.find("#ssi-clearBtn"),k=this.$element.find("#ssi-fileList"),g=this.$element.find(".ssi-uploadBox"),n=[];0===this.inProgress&&0===this.pending&&this.clear();var m=[],y=[],w="",t,q=e=t=a.length;"number"===typeof this.options.maxNumberOfFiles&&q>this.options.maxNumberOfFiles-(this.inProgress+this.pending)&&(q=t=this.options.maxNumberOfFiles-(this.inProgress+this.pending));for(var u=0;u<q;u++){var p=a[u],x=p.name.getExtension();-1===
f.inArray(x,this.options.allowed)?(e>q?q++:t--,-1===f.inArray(x,m)&&m.push(x)):(p.size*Math.pow(10,-6)).toFixed(2)>this.options.maxFileSize?(e>q?q++:t--,y.push(v(p.name,x,15))):-1===f.inArray(p.name,this.imgNames)?(r.prop("disabled",!1),c(p),this.pending++,this.currentListLength++):e>q?q++:t--}a=m.length;e=y.length;0<a+e&&(0<a&&(w=this.language.extError.replaceText(m.toString().replace(/,/g,", "))),0<e&&(w+=this.language.sizeError.replaceText(y.toString().replace(/,/g,", "),this.options.maxFileSize+
"mb")),this.options.errorHandler.method(w,this.options.errorHandler.error))}};var C=function(a){var c=a.$element.find(".ssi-completed");a.successfulUpload=0;a.aborted=0;a.abortedWithError=0;a.options.preview||c.prev("tr").remove();c.remove()},D=function(a){for(var c=a.$element.find(".ssi-pending"),d=a.imgNames.length,b=0;b<d;b++)null===a.imgNames[b]&&(a.toUpload.splice(b,1),a.imgNames.splice(b,1));a.toUpload.splice(-a.pending,a.pending);a.imgNames.splice(-a.pending,a.pending);a.pending=0;a.options.preview||
c.prev("tr").remove();c.remove();console.log(a.imgNames)};k.prototype.clear=function(a){switch(a){case "pending":D(this);break;case "completed":C(this);break;default:D(this),C(this)}a=this.$element.find("#ssi-uploadBtn");var c=this.$element.find("#ssi-clearBtn");this.currentListLength=this.inProgress+this.successfulUpload+this.aborted+this.abortedWithError+this.pending;0===this.inProgress&&(this.totalProgress=[]);0===this.currentListLength&&(c.addClass("ssi-hidden"),a.addClass("ssi-hidden"),this.totalFilesLength=
0,this.options.dropZone||this.$element.find(".ssi-uploadBox").removeClass("ssi-uploadNoDropZone"));c.prop("disabled",!0);a.prop("disabled",!0);this.options.preview||E(this)};var E=function(a){1<a.currentListLength?a.$element.find(".ssi-namePreview").html(a.currentListLength+" files"):1===a.currentListLength?B(a):(a.$element.find(".ssi-uploadDetails").removeClass("ssi-uploadBoxOpened"),a.$element.find("#ssi-fileList").empty(),a.$element.find(".ssi-namePreview").empty())};k.prototype.uploadFiles=function(){function a(e,
h){var k="table.ssi-imgToUploadTable";b.options.preview||(k="tr.ssi-toUploadTr");var g=b.$element.find("#ssi-uploadProgress"+h);g.removeClass("ssi-hidden").parents(k).removeClass("ssi-pending");f.ajax({xhr:function(){var a=new window.XMLHttpRequest;a.upload.addEventListener("progress",function(a){if(a.lengthComputable){a=a.loaded/a.total*100;g&&g.css({width:a+"%"});b.totalProgress[h]=a;a=b.totalProgress;for(var d=0,e=0;e<a.length;e++)"number"===typeof a[e]&&(d+=a[e]);a=d/(b.inProgress+b.successfulUpload);
b.options.preview||b.$element.find("#ssi-uploadProgressNoPreview").removeClass("ssi-hidden").css({width:a+"%"});c.find("#ssi-up_loading").html(Math.ceil(a)+"%")}},!1);return a},async:!0,beforeSend:function(a){b.uploadList[h]=a;c.find("#ssi-up_loading").html('<i class="fa fa-spinner fa-pulse"></i>');if("function"===typeof b.options.beforeEachUpload)var d=b.options.beforeEachUpload({name:b.toUpload[h].name,type:b.toUpload[h].type,size:(b.toUpload[h].size/1024).toFixed(2)},a);b.$element.find("input.ssi-uploadInput").trigger("beforeEachUpload.ssi-uploader");
0===a.status&&"canceled"===a.statusText&&("undefined"===typeof d&&(d=!1),b.abortedWithError++,u(b,h,d))},type:"POST",data:e,cache:!1,contentType:!1,processData:!1,url:b.options.url,error:function(a,c){if("abort"!==c){g.addClass("ssi-canceledProgressBar");var e=b.language.error;b.abortedWithError++;b.totalProgress.splice(h,1);b.options.preview||(e='<span class="exclamation7"></span>');z(b,h,"error",e,b.language.serverError);b.totalProgress[h]="";b.inProgress--;d.prop("disabled",!1);0===b.inProgress&&
A(b);console.log(arguments);console.log(" Ajax error: "+c)}}}).done(function(a){var c,e="",l="error",k="exclamation";a=f.parseJSON(a);"success"===a.type?(l="success",c=b.language.success,k="check",b.successfulUpload++):("console"===a.type?(console.log(a.msg),c=b.language.error,e=b.language.uploadFailed):(b.options.preview&&(g.addClass("ssi-canceledProgressBar"),c=b.language.error),e=a.msg),b.abortedWithError++);b.options.preview||(c='<span class="'+k+'7"></span>');z(b,h,l,c,e);if("function"===typeof b.options.onEachUpload)b.options.onEachUpload({uploadStatus:a.type,
name:b.toUpload[h].name,size:(b.toUpload[h].size/1024).toFixed(2),type:b.toUpload[h].type});b.$element.find("input.ssi-uploadInput").trigger("onEachUpload.ssi-uploader");b.inProgress--;d.prop("disabled",!1);0===b.inProgress&&A(b);b.uploadList[h]="";b.toUpload[h]="";b.imgNames[h]=""});l=h;for(l++;null===b.toUpload[l];)l++;l<b.toUpload.length&&(e=new FormData,f.each(b.options.data,function(a,b){e.append(a,b)}),e.append("files[]",b.toUpload[l]),a(e,l))}if(0<this.pending){this.$element.find("#ssi-abortBtn").removeClass("ssi-hidden");
this.$element.find(".ssi-removeBtn").addClass("ssi-abortUpload").removeClass("ssi-removeBtn").children("span").removeClass("trash7 trash10 trash").addClass(this.options.preview?"ban7w":"ban7");var c=this.$element.find("#ssi-uploadBtn"),d=this.$element.find("#ssi-clearBtn");c.prop("disabled",!0);var b=this,e=new FormData,l=this.totalFilesLength;0===this.totalFilesLength||this.options.preview||E(this);this.inProgress+=this.pending;this.totalFilesLength+=this.pending;this.pending=0;for(this.inProgress===
this.currentListLength&&d.prop("disabled",!0);null===this.toUpload[l];)l++;e.append("files[]",b.toUpload[l]);f.each(this.options.data,function(a,b){e.append(a,b)});"function"===typeof this.options.beforeUpload&&this.options.beforeUpload();b.$element.find("input.ssi-uploadInput").trigger("beforeUpload.ssi-uploader");a(e,l)}};var z=function(a,c,d,b,e){var f="",k="table.ssi-imgToUploadTable";a.options.preview||(f="ssi-noPreviewSubMessage",k="tr.ssi-toUploadTr",1===a.currentListLength&&(a.errors=e));
a=a.$element.find(".ssi-abortUpload[data-delete='"+c+"']");a.parents(k).addClass("ssi-completed");a.after(F(d,b,e,f)).remove()},F=function(a,c,d,b){return'<span class="ssi-statusLabel '+b+" "+a+'" data-status="'+d+'">'+c+"</span>"},B=function(a){var c=a.$element.find("#ssi-fileList").find("span").html(),d=c.getExtension();a.$element.find(".ssi-uploadDetails").removeClass("ssi-uploadBoxOpened");a.$element.find(".ssi-namePreview").html(v(c,d,15))},u=function(a,c,d){"undefined"===typeof d?(a.uploadList[c].abort(),
a.totalProgress[c]="",d="Aborted",a.aborted++):"string"!==typeof d&&(d="");var b=a.language.aborted;a.options.preview||(b='<span class="ban7w"></span>');z(a,c,"error",b,d);a.$element.find("#ssi-uploadProgress"+c).removeClass("ssi-hidden").addClass("ssi-canceledProgressBar");a.toUpload[c]=void 0;a.uploadList[c]=void 0;a.imgNames[c]=void 0;a.$element.find("#ssi-clearBtn").prop("disabled",!1);a.inProgress--;0===a.inProgress&&A(a)},A=function(a){a.$element.find("#ssi-abortBtn").addClass("ssi-hidden");
if(!a.options.preview){var c="error",d="",b="";0<a.abortedWithError?(d=1===a.totalFilesLength?a.errors:a.language.someErrorsOccurred,b='<span class="exclamation23"></span>'):0<a.aborted&&0===a.successfulUpload?(b='<span class="ban23"></span>',d=a.language.aborted):0<a.successfulUpload&&(c="success",b='<span class="check23"></span>',d=a.language.sucUpload);a.$element.find(".ssi-namePreview").append(F(c,b,d,"ssi-noPreviewMessage"));a.$element.find("#ssi-uploadProgressNoPreview").removeAttr("styles").addClass("ssi-hidden")}if("function"===
typeof a.options.onUpload)a.options.onUpload();a.$element.find("input.ssi-uploadInput").trigger("onUpload.ssi-uploader");c=a.$element.find("#ssi-uploadBtn");a.$element.find("#ssi-clearBtn").prop("disabled",!1);c.prop("disabled",!1).find("#ssi-up_loading").empty();0===a.pending&&(c.addClass("ssi-hidden"),a.toUpload=[],a.imgNames=[],a.totalFilesLength=0);a.uploadList=[];a.totalProgress=[];a.currentListLength=a.inProgress+a.successfulUpload+a.aborted+a.abortedWithError+a.pending;a.successfulUpload=0;
a.aborted=0;a.abortedWithError=0;a.inProgress=0};f.fn.ssi_uploader=function(a){var c=f.extend(!0,{url:"",data:{},locale:"en",preview:!0,dropZone:!0,maxNumberOfFiles:"",maxFileSize:2,onUpload:function(){},onEachUpload:function(){},beforeUpload:function(){},beforeEachUpload:function(){},allowed:["jpg","jpeg","png","bmp","gif"],errorHandler:{method:function(a){alert(a)},success:"success",error:"error"}},a);return this.each(function(){var a=f(this);if(a.is('input[type="file"]')){if(!a.data("ssi_upload")){var b=
new k(this,c);a.data("ssi_upload",b)}}else console.log("the targeted element is not file input")})};String.prototype.replaceText=function(){for(var a=Array.apply(null,arguments),c=this,d=0;d<a.length;d++)c=c.replace("$"+(d+1),a[d]);return c};String.prototype.getExtension=function(){return this.split(".").pop().toLowerCase()};var v=function(a,c,d){"undefined"===typeof c&&(c="");"undefined"===typeof d&&(d=10);if(!(4>d)){var b=c.length;return a.length-2>d?(a=a.substring(0,d),a=a.substring(0,a.length-
b),a+"..."+c):a}},G={en:{success:"Success",sucUpload:"Successful upload",chooseFiles:"Choose files",uploadFailed:"Upload failed",serverError:"Internal server error",error:"Error",abort:"Abort",aborted:"Aborted",files:"files",upload:"Upload",clear:"Clear",drag:"Drag n Drop",sizeError:"$1 exceed the size limit of $2",extError:"$1 file types are not supported",someErrorsOccurred:"Some errors occurred!"},gr:{success:"\u0395\u03c0\u03b9\u03c4\u03c5\u03c7\u03af\u03b1",sucUpload:"\u0395\u03c0\u03b9\u03c4\u03c5\u03c7\u03ae\u03c2 \u03bc\u03b5\u03c4\u03b1\u03c6\u03cc\u03c1\u03c4\u03c9\u03c3\u03b7",
chooseFiles:"\u0395\u03c0\u03b9\u03bb\u03ad\u03be\u03c4\u03b5 \u03b1\u03c1\u03c7\u03b5\u03af\u03b1",uploadFailed:"\u0397 \u03bc\u03b5\u03c4\u03b1\u03c6\u03cc\u03c1\u03c4\u03c9\u03c3\u03b7 \u03b1\u03c0\u03ad\u03c4\u03c5\u03c7\u03b5!",serverError:"\u0395\u03c3\u03c9\u03c4\u03b5\u03c1\u03b9\u03ba\u03cc \u03c3\u03c6\u03ac\u03bb\u03bc\u03b1 \u03b4\u03b9\u03b1\u03ba\u03bf\u03bc\u03b9\u03c3\u03c4\u03ae!",error:"\u03a3\u03c6\u03ac\u03bb\u03bc\u03b1",abort:"\u0394\u03b9\u03b1\u03ba\u03bf\u03c0\u03ae",aborted:"\u0394\u03b9\u03b1\u03ba\u03cc\u03c0\u03b7\u03ba\u03b5",
files:"\u03b1\u03c1\u03c7\u03b5\u03af\u03b1",upload:"\u039c\u03b5\u03c4\u03b1\u03c6\u03cc\u03c1\u03c4\u03c9\u03c3\u03b7",clear:"\u0395\u03ba\u03ba\u03b1\u03b8\u03ac\u03c1\u03b9\u03c3\u03b7",drag:"\u03a3\u03c5\u03c1\u03b5\u03c4\u03b5 \u03b5\u03b4\u03ce...",sizeError:"$1 \u03ad\u03c7\u03b5\u03b9 \u03be\u03b5\u03c0\u03b5\u03c1\u03ac\u03c3\u03b5\u03b9 \u03c4\u03bf \u03cc\u03c1\u03b9\u03bf \u03c4\u03c9\u03bd $2.",extError:"$1 \u03b1\u03c1\u03c7\u03b5\u03af\u03b1 \u03b4\u03b5\u03bd \u03c5\u03c0\u03bf\u03c3\u03c4\u03b7\u03c1\u03af\u03b6\u03bf\u03bd\u03c4\u03b1\u03b9.",
someErrorsOccurred:"\u03a3\u03b7\u03bc\u03b5\u03b9\u03ce\u03b8\u03b7\u03ba\u03b1\u03bd \u03bf\u03c1\u03b9\u03c3\u03bc\u03ad\u03bd\u03b1 \u03bb\u03ac\u03b8\u03b7!"}}});
